<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ุฃุฏุงุฉ ุฏูุฌ ุฃูุฑุงู Excel ุจุณูููุฉ ูุณุฑุนุฉ</title>
  <meta name="theme-color" content="#2c3e50">
  <link rel="manifest" href="manifest.json">
<link rel="icon" href="favicon.ico" type="image/x-icon">
<script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
  <style>
    /* ุชูุณูู ุงูุตูุญุฉ ุจุงููุงูู ููุง ูู ุงููุณุฎุฉ ุงูุณุงุจูุฉ */
    /* ... (ููุณ ุงูุชูุณููุงุช ุงูุณุงุจูุฉ) ... */
  </style>
</head>
<body oncontextmenu="return false">
  <div id="splash">๐งฉ ุฌุงุฑู ุชุญููู ุงูุฃุฏุงุฉ...</div>

  <h2>ุฃุฏุงุฉ ุฏูุฌ ุฃูุฑุงู Excel ุจุณูููุฉ ูุณุฑุนุฉ</h2>
  <input type="file" id="fileInput" multiple accept=".xlsx,.csv"><br>
  <label for="sheetIndex">๐ข ุฑูู ุงููุฑูุฉ ุงููุทููุจ ุฏูุฌูุง (ุงุฎุชูุงุฑู):</label>
  <input type="number" id="sheetIndex" min="1" placeholder="ูุซูุงู: 1"><br>
  <div id="sheetSelectors"></div>
  <button onclick="mergeFiles()">โ ุฏูุฌ ูุชุญููู ุงูููู</button>
  <button onclick="resetForm()">๐ ุฅุนุงุฏุฉ ุชุนููู</button>
  <p id="status"></p>
  <p class="note">โ๏ธ ุฅุฐุง ุธูุฑุช ุฑุณุงูุฉ ุชุญุฐูุฑ ูู Windowsุ ูุฑุฌู ุงูุชุฃูุฏ ุฃู ุงูููู ุชู ุฅูุดุงุคู ูุญูููุง ููู ุขูู ุชูุงููุง.</p>

  <script>
    // ุดุงุดุฉ ุงูุชุฑุญูุจ + ุชุณุฌูู ุญุฏุซ ููุญุฉ ุงูููุงุชูุญ
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.getElementById('splash').style.display = 'none';
      }, 1500);

      window.addEventListener('keydown', blockKeys);
    });

    // ุชุณุฌูู Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('โ Service Worker ูุณุฌู ุจูุฌุงุญ'))
        .catch(err => console.error('โ ูุดู ุชุณุฌูู Service Worker', err));
    }

    // ููุน ุงุฎุชุตุงุฑุงุช ุงููุณุฎ ูุงูุญูุธ
    function blockKeys(e) {
      const forbidden = [
        { key: 'u', ctrl: true },
        { key: 'c', ctrl: true },
        { key: 's', ctrl: true },
        { key: 'a', ctrl: true },
        { key: 'x', ctrl: true }
      ];
      const isBlocked = forbidden.some(f =>
        e.key.toLowerCase() === f.key && (f.ctrl ? e.ctrlKey : true)
      );
      if (isBlocked) {
        e.preventDefault();
        return false;
      }
      return true;
    }

    const sheetSelectors = document.getElementById('sheetSelectors');
    const status = document.getElementById('status');
    let fileSheetMap = {};

    document.getElementById('fileInput').addEventListener('change', async function () {
      const files = Array.from(this.files);
      sheetSelectors.innerHTML = '';
      fileSheetMap = {};
      status.textContent = "โณ ุฌุงุฑู ุชุญููู ุงููููุงุช...";

      const loadPromises = files.map(file => {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = function (e) {
            try {
              let workbook;
              const data = e.target.result;
              if (file.name.endsWith('.csv')) {
                workbook = XLSX.read(data, { type: 'binary' });
              } else {
                workbook = XLSX.read(data, { type: 'array' });
              }

              const sheetNames = workbook.SheetNames;
              fileSheetMap[file.name] = { workbook, sheetNames };

              const label = document.createElement('label');
              label.textContent = `๐๏ธ ุงุฎุชุฑ ุงููุฑูุฉ ูู ุงูููู: ${file.name}`;

              const select = document.createElement('select');
              select.className = 'sheet-select';
              select.name = file.name;

              sheetNames.forEach((name, index) => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = `(${index + 1}) ${name}`;
                select.appendChild(option);
              });

              sheetSelectors.appendChild(label);
              sheetSelectors.appendChild(select);
              resolve();
            } catch (err) {
              reject(err);
            }
          };

          if (file.name.endsWith('.csv')) {
            reader.readAsBinaryString(file);
          } else {
            reader.readAsArrayBuffer(file);
          }
        });
      });

      try {
        await Promise.all(loadPromises);
        status.textContent = "โ ุชู ุชุญููู ุงููููุงุช ุจูุฌุงุญุ ููููู ุงูุขู ุงุฎุชูุงุฑ ุงูุฃูุฑุงู ูุงูุฏูุฌ.";
      } catch {
        status.textContent = "โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุจุนุถ ุงููููุงุช.";
      }
    });

    function applyGlobalSheetIndex() {
      const index = parseInt(document.getElementById('sheetIndex').value) - 1;
      const selects = document.querySelectorAll('.sheet-select');

      selects.forEach(select => {
        select.classList.remove('invalid');
        if (!isNaN(index) && index >= 0 && index < select.options.length) {
          select.selectedIndex = index;
        } else {
          select.classList.add('invalid');
        }
      });
    }

    async function mergeFiles() {
      const files = Array.from(document.getElementById('fileInput').files);
      if (!files.length) {
        status.textContent = "โ๏ธ ูู ูุชู ุงุฎุชูุงุฑ ุฃู ูููุงุช.";
        alert("ูุฑุฌู ุงุฎุชูุงุฑ ุงููููุงุช ุฃููุงู");
        return;
      }

      status.textContent = "โณ ุฌุงุฑู ุงูุฏูุฌ...";
      const mergedWorkbook = XLSX.utils.book_new();

      for (const file of files) {
        const fileData = fileSheetMap[file.name];
        if (!fileData) continue;

        const { workbook } = fileData;
        const selectedSheet = document.querySelector(`select[name="${file.name}"]`).value;
        const worksheet = workbook.Sheets[selectedSheet];
        if (!


  </script>
</body>
</html>

